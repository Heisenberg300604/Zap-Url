#service: zapurl-backend
#
#frameworkVersion: '3'
#
#provider:
#  name: aws
#  runtime: nodejs20.x
#  stage: ${opt:stage, 'dev'}
#  region: ${opt:region, 'ap-south-1'}  # Mumbai, change as needed
#
#  # API Gateway configuration
#  apiGateway:
#    shouldStartNameWithService: true
#    minimumCompressionSize: 1024  # Enable gzip compression
#    binaryMediaTypes:
#      - 'multipart/form-data'
#      - 'image/*'
#      - 'application/pdf'
#
#  # CloudWatch Logs retention
#  logs:
#    restApi:
#      accessLogging: true
#      format: '{"requestId":"$context.requestId","ip":"$context.identity.sourceIp","requestTime":"$context.requestTime","httpMethod":"$context.httpMethod","routeKey":"$context.routeKey","status":"$context.status"}'
#      executionLogging: true
#      level: INFO
#      fullExecutionData: true
#    httpApi:
#      format: '{"requestId":"$context.requestId","ip":"$context.identity.sourceIp","requestTime":"$context.requestTime","httpMethod":"$context.httpMethod","routeKey":"$context.routeKey","status":"$context.status"}'
#
#  # Environment variables
#  environment:
#    NODE_ENV: ${self:provider.stage}
#    STAGE: ${self:provider.stage}
#    REGION: ${self:provider.region}
#    BASE_URL: ${env:BASE_URL, 'https://your-api-gateway-url.execute-api.ap-south-1.amazonaws.com/dev'}
#    DYNAMO_TABLE: ${env:DYNAMO_TABLE, 'UrlTable'}
#    REDIS_URL: ${env:REDIS_URL}
#    ARCJET_ENV: ${env:ARCJET_ENV, 'production'}
#    ARCJET_KEY: ${env:ARCJET_KEY}
##    NODE_ENV: ${self:provider.stage}
##    STAGE: ${self:provider.stage}
##    REGION: ${self:provider.region}
#
#    # Database - use SSM Parameter Store for sensitive data
#    # DB_HOST: ${ssm:/your-app/${self:provider.stage}/db-host}
#    # DB_NAME: ${ssm:/your-app/${self:provider.stage}/db-name}
#    # DB_USER: ${ssm:/your-app/${self:provider.stage}/db-user}
#    # DB_PASSWORD: ${ssm:/your-app/${self:provider.stage}/db-password~true}
#
#    # Redis/ElastiCache (add when ready)
#    # REDIS_HOST: ${ssm:/your-app/${self:provider.stage}/redis-host}
#    # REDIS_PORT: 6379
#
#    # JWT Secret (use SSM for production)
#    # JWT_SECRET: ${ssm:/your-app/${self:provider.stage}/jwt-secret~true}
#
#    # API Keys (use SSM)
#    # STRIPE_SECRET_KEY: ${ssm:/your-app/${self:provider.stage}/stripe-key~true}
#
#  # VPC Configuration (uncomment if using RDS/ElastiCache in VPC)
#  # vpc:
#  #   securityGroupIds:
#  #     - sg-xxxxxxxxx
#  #   subnetIds:
#  #     - subnet-xxxxxxxxx
#  #     - subnet-yyyyyyyyy
#
#  # IAM Role permissions
#  iam:
#    role:
#      name: ${self:service}-${self:provider.stage}-lambda-role
#      statements:
#        # CloudWatch Logs
#        - Effect: Allow
#          Action:
#            - logs:CreateLogGroup
#            - logs:CreateLogStream
#            - logs:PutLogEvents
#          Resource: "arn:aws:logs:${self:provider.region}:*:*"
#
#        # DynamoDB permissions
#        - Effect: Allow
#          Action:
#            - dynamodb:Query
#
#        # S3 permissions (uncomment if using S3 for file uploads)
#        # - Effect: Allow
#        #   Action:
#        #     - s3:GetObject
#        #     - s3:PutObject
#        #     - s3:DeleteObject
#        #   Resource: "arn:aws:s3:::${self:service}-${self:provider.stage}-uploads/*"
#
#        # Secrets Manager (uncomment if using Secrets Manager)
#        # - Effect: Allow
#        #   Action:
#        #     - secretsmanager:GetSecretValue
#        #   Resource: "arn:aws:secretsmanager:${self:provider.region}:*:secret:${self:service}/${self:provider.stage}/*"
#
#        # Systems Manager Parameter Store
#        # - Effect: Allow
#        #   Action:
#        #     - ssm:GetParameter
#        #     - ssm:GetParameters
#        #     - ssm:GetParametersByPath
#        #   Resource: "arn:aws:ssm:${self:provider.region}:*:parameter/${self:service}/${self:provider.stage}/*"
#
#        # SES (for sending emails)
#        # - Effect: Allow
#        #   Action:
#        #     - ses:SendEmail
#        #     - ses:SendRawEmail
#        #   Resource: "*"
#
#        # SNS (for notifications)
#        # - Effect: Allow
#        #   Action:
#        #     - sns:Publish
#        #   Resource: "arn:aws:sns:${self:provider.region}:*:${self:service}-${self:provider.stage}-*"
#
#        # SQS (for queues)
#        # - Effect: Allow
#        #   Action:
#        #     - sqs:SendMessage
#        #     - sqs:ReceiveMessage
#        #     - sqs:DeleteMessage
#        #     - sqs:GetQueueAttributes
#        #   Resource: "arn:aws:sqs:${self:provider.region}:*:${self:service}-${self:provider.stage}-*"
#
#functions:
#  api:
#    handler: lambda.handler
#    name: ${self:service}-${self:provider.stage}-api
#    description: Main API Lambda function
#    timeout: 30  # seconds (max 900 for Lambda, but API Gateway times out at 30)
#    memorySize: 512  # MB (128-10240) - adjust based on your needs
#
#    # Reserved concurrent executions (uncomment for production)
#    # reservedConcurrency: 10
#
#    # Provisioned concurrency (keeps containers warm, costs more)
#    # provisionedConcurrency: 2
#
#    events:
#      - http:
#          path: /
#          method: ANY
#          cors:
#            origin: '*'  # Change to specific domains in production
#            headers:
#              - Content-Type
#              - X-Amz-Date
#              - Authorization
#              - X-Api-Key
#              - X-Amz-Security-Token
#              - X-Amz-User-Agent
#            allowCredentials: false
#      - http:
#          path: /{proxy+}
#          method: ANY
#          cors:
#            origin: '*'
#            headers:
#              - Content-Type
#              - X-Amz-Date
#              - Authorization
#              - X-Api-Key
#              - X-Amz-Security-Token
#              - X-Amz-User-Agent
#            allowCredentials: false
#
## Additional Lambda functions (example for background jobs)
## backgroundJob:
##   handler: jobs/handler.process
##   name: ${self:service}-${self:provider.stage}-job
##   timeout: 300
##   memorySize: 1024
##   events:
##     - schedule:
##         rate: cron(0 2 * * ? *)  # Run at 2 AM UTC daily
##         enabled: true
#
## DynamoDB Tables (uncomment when needed)
## resources:
##   Resources:
##     UsersTable:
##       Type: AWS::DynamoDB::Table
##       Properties:
##         TableName: ${self:service}-${self:provider.stage}-users
##         BillingMode: PAY_PER_REQUEST  # or PROVISIONED
##         AttributeDefinitions:
##           - AttributeName: id
##             AttributeType: S
##           - AttributeName: email
##             AttributeType: S
##         KeySchema:
##           - AttributeName: id
##             KeyType: HASH
##         GlobalSecondaryIndexes:
##           - IndexName: EmailIndex
##             KeySchema:
##               - AttributeName: email
##                 KeyType: HASH
##             Projection:
##               ProjectionType: ALL
##         StreamSpecification:
##           StreamViewType: NEW_AND_OLD_IMAGES
##         PointInTimeRecoverySpecification:
##           PointInTimeRecoveryEnabled: true
##         Tags:
##           - Key: Environment
##             Value: ${self:provider.stage}
##
##     # S3 Bucket for file uploads
##     UploadsBucket:
##       Type: AWS::S3::Bucket
##       Properties:
##         BucketName: ${self:service}-${self:provider.stage}-uploads
##         CorsConfiguration:
##           CorsRules:
##             - AllowedOrigins:
##                 - '*'
##               AllowedHeaders:
##                 - '*'
##               AllowedMethods:
##                 - GET
##                 - PUT
##                 - POST
##                 - DELETE
##                 - HEAD
##               MaxAge: 3000
#
## Plugins
#plugins:
#  - serverless-offline
#  # - serverless-domain-manager  # For custom domains
#  # - serverless-plugin-warmup  # Keep Lambda warm
#  # - serverless-prune-plugin  # Remove old versions
#
## Custom configurations
#custom:
#  # Serverless Offline (local development)
#  serverless-offline:
#    httpPort: 3000
#    websocketPort: 3001
#    lambdaPort: 3002
#    noPrependStageInUrl: true
#    ignoreJWTSignature: true
#
#  # Prune old Lambda versions (keep last 3)
#  # prune:
#  #   automatic: true
#  #   number: 3
#
#  # Custom domain (requires domain setup in Route53)
#  # customDomain:
#  #   domainName: ${self:provider.stage}.api.yourdomain.com
#  #   basePath: ''
#  #   stage: ${self:provider.stage}
#  #   createRoute53Record: true
#
#  # Warmup configuration (prevents cold starts)
#  # warmup:
#  #   default:
#  #     enabled: true
#  #     events:
#  #       - schedule: rate(5 minutes)
#  #     concurrency: 1
#
## Package configuration
#package:
#  individually: false
#  patterns:
#    - '!.git/**'
#    - '!.github/**'
#    - '!.vscode/**'
#    - '!.idea/**'
#    - '!test/**'
#    - '!tests/**'
#    - '!*.test.js'
#    - '!*.spec.js'
#    - '!.env*'
#    - '!.eslintrc*'
#    - '!.prettierrc*'
#    - '!nodemon.json'
#    - '!README.md'
#    - '!LICENSE'
#    - '!*.md'
#    - '!coverage/**'
#    - '!.DS_Store'
#    # Include only production dependencies
#    - '!node_modules/.cache/**'
#    - '!node_modules/aws-sdk/**'  # Already available in Lambda